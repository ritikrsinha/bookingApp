<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
    <title>Booking Appointment App</title>
</head>
<body>
  <form class="form-detail" onsubmit="saveToLocalStorage(event)">
  <h1 class="title"> Book a call!</h1>
  <p class="booking"> Book a call slot and our representative will call you back.</p>
  <hr>
    <label> Name:</label> <br>
    <input id="username" type ="text" name="username" required /> <br>
    <label> Email: </label> <br>
    <input id="email" type ="email" name="email" required /> <br>
    <label> Phone: </label> <br>
    <input id="phonenumber" type="number" name="phonenumber" required /> <br>
    <label>Time for call:</label><br>
    <input id='calldate' type="date" name="calldate" value="" style="width:237px;">
    <input id="calltime" type="time" name="calltime" value="" style="width:237px;";><br><br>
    <button class="btn">Get a call</button> 
    </form>
    <ul id="listOfUsers"></ul>
    <script>
     function saveToLocalStorage(event){
      event.preventDefault();
      const name = event.target.username.value;
      const email = event.target.email.value;
      const phonenumber = event.target.phonenumber.value;
      const calldate = event.target.calldate.value;
      const calltime = event.target.calltime.value;
      const obj = {
               name,
               email,
               phonenumber,
               calldate,
               calltime
           }
      localStorage.setItem(obj.email, JSON.stringify(obj));
      showNewUserOnScreen(obj)
     }

     function showNewUserOnScreen(user){
      document.getElementById('email').value = '';
      document.getElementById('username').value = '';
      document.getElementById('phonenumber').value = '';
      document.getElementById('calldate').value = '';
      document.getElementById('calltime').value = '';
      if(localStorage.getItem(user.email) !== null){
            removeUserFromScreen(user.email)
           }

      const parentNode = document.getElementById('listOfUsers');
      const childHTML = `<li id=${user.email}> ${user.name} - ${user.email} - ${user.phonenumber} - ${user.calldate} - ${user.calltime}
      <button onclick=deleteUser('${user.email}')> Delete User </button>
      <button class='editbutton' onclick=editUserDetails('${user.email}','${user.name}','${user.phonenumber}','${user.calldate}','${user.calltime}')>Edit User </button>
                              </li>`
      parentNode.innerHTML = parentNode.innerHTML + childHTML;
     }

    //  delete user
     function deleteUser(email){
           console.log(email);
           localStorage.removeItem(email);
           removeUserFromScreen(email);
     }
    //   edit user
     function editUserDetails(email, name, phonenumber, calldate, calltime){
      document.getElementById('email').value = email;
      document.getElementById('username').value = name;
      document.getElementById('phonenumber').value = phonenumber;
      document.getElementById('calldate').value = calldate
      document.getElementById('calltime').value = calltime;
      deleteUser(email);

     }

     function removeUserFromScreen(email){
      const parentNode = document.getElementById('listOfUsers');
      const childNodeToBeDeleted = document.getElementById(email);

      parentNode.removeChild(childNodeToBeDeleted);
     }

        const localStorageObj = localStorage;
        const localstoragekeys  = Object.keys(localStorageObj)

         for(var i =0; i< localstoragekeys.length; i++){
           const key = localstoragekeys[i]
           const userDetailsString = localStorageObj[key];
           const userDetailsObj = JSON.parse(userDetailsString);
           showNewUserOnScreen(userDetailsObj)
           }
      
       function removeUserFromScreen(emailId){
           const parentNode = document.getElementById('listOfUsers');
           const childNodeToBeDeleted = document.getElementById(emailId);
          if(childNodeToBeDeleted) {
            parentNode.removeChild(childNodeToBeDeleted)
          }
       }
    </script>

</body>
</html>